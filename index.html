<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ç»™ä½ çš„ä¸“å±çƒŸèŠ±ğŸ†</title>
<style>
  :root{
    --glass: rgba(255,255,255,.06);
    --glass-strong: rgba(255,255,255,.12);
    --txt: #fff;
    --hint: rgba(255,255,255,.78);
    --shadow: 0 10px 30px rgba(0,0,0,.35);
    --radius: 16px;
    --blur: saturate(120%) blur(8px);
    --safe-l: max(12px, env(safe-area-inset-left));
    --safe-r: max(12px, env(safe-area-inset-right));
    --safe-t: max(12px, env(safe-area-inset-top));
    --safe-b: max(12px, env(safe-area-inset-bottom));
  }
  html,body{height:100%;margin:0;background:#0b1020;color:#fff;overflow:hidden;-webkit-tap-highlight-color:transparent}
  #c{position:fixed;inset:0;display:block}

  /* é¡¶éƒ¨ç¥ç¦ä¸æç¤ºï¼ˆå§‹ç»ˆåœ¨æŒ‰é’®ä¹‹ä¸Šï¼›ä¸æŒ¡ç‚¹å‡»ï¼‰ */
  .overlay{
    position:fixed;inset:0;display:flex;flex-direction:column;
    align-items:center;justify-content:center;text-align:center;padding:24px;gap:18px;
    z-index:9; pointer-events:none;
  }
  .overlay .msg{
    font-family: ui-rounded, "SF Pro Rounded", system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans CJK SC", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
    font-weight:700;line-height:1.2;
    font-size: clamp(24px, 6vw, 56px);
    text-shadow: 0 0 12px rgba(255,255,255,.35), 0 0 30px rgba(120,170,255,.25);
    letter-spacing:.02em
  }
  .overlay .hint{
    font: 500 12px/1.2 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
    opacity:.75
  }
  .badge{
    position:fixed;left:var(--safe-l);bottom:var(--safe-b);font:600 11px/1 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    opacity:.55;pointer-events:none;z-index:1;
  }
  a, a:visited{color:#cbe0ff}

  /* ä¸­å¤®ç«–å‘æŒ‰é’®èœå•ï¼ˆæ•´ä½“ä¸‹ç§»äº›ï¼Œé¿å…å‹ä½æ ‡é¢˜ï¼‰ */
  .center-menu{ position:fixed; inset:0; display:grid; place-items:center; z-index:2; }
  .center-stack{ display:grid; gap:12px; width:min(92vw, 420px); transform: translateY(clamp(48px, 14vh, 160px)); }
  .menu-btn{
    display:flex; align-items:center; justify-content:center; gap:10px;
    padding:16px 18px; border-radius: var(--radius);
    background: var(--glass);
    backdrop-filter: var(--blur); -webkit-backdrop-filter: var(--blur);
    border:1px solid rgba(255,255,255,.15);
    color:var(--txt); box-shadow: var(--shadow);
    font: 800 clamp(16px, 2.6vw, 20px)/1.2 ui-rounded, "SF Pro Rounded", system-ui, -apple-system, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
    letter-spacing:.08em; cursor:pointer; user-select:none;
    transition: transform .2s ease, background .2s ease, opacity .2s ease;
    touch-action: manipulation;
  }
  .menu-btn:hover{ background: var(--glass-strong); opacity:1; }
  .menu-btn:active{ transform: scale(.98); }
  .menu-btn .emoji{ font-size:20px; filter: drop-shadow(0 2px 6px rgba(0,0,0,.35)); }

  /* æ¿å—é¢æ¿ï¼ˆè¦†ç›–å±‚ï¼‰ */
  .panel{
    position:fixed;inset:0; z-index:3;
    display:grid; grid-template-columns: 1fr;
    align-items:center;justify-items:center;
    padding: clamp(12px, 5vw, 40px);
    background: radial-gradient(1200px 1200px at 50% 30%, rgba(25,35,70,.65), rgba(8,12,28,.86) 60%, rgba(5,8,20,.96) 100%);
    opacity:0; pointer-events:none;
    transition: opacity .25s ease;
  }
  .panel.show{ opacity:1; pointer-events:auto; }

  .panel-card{
    width:min(1100px, 100%);
    display:grid; grid-template-columns: 1.1fr .9fr;
    gap: clamp(12px, 4vw, 36px); align-items:center;
    background: var(--glass);
    border:1px solid rgba(255,255,255,.12);
    border-radius: 18px;
    backdrop-filter: var(--blur); -webkit-backdrop-filter: var(--blur);
    box-shadow: var(--shadow);
    padding: clamp(14px, 4vw, 28px);
  }
  @media (max-width: 880px){ .panel-card{ grid-template-columns: 1fr; } }

  .panel h2{
    margin:0 0 6px 0;
    font: 800 clamp(20px, 4.2vw, 34px)/1.25 ui-rounded, "SF Pro Rounded", system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans CJK SC", "PingFang SC", "Microsoft YaHei", sans-serif;
    letter-spacing:.02em; text-shadow: 0 0 10px rgba(140,170,255,.25);
  }
  .panel p{
    margin:.3em 0 0 0;
    font: 500 clamp(14px, 2.8vw, 18px)/1.65 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif;
    color: var(--hint);
  }

  /* å³ä¾§å®¹å™¨ï¼ˆå›¾/ç›¸å†Œï¼‰ */
  .silhouette-wrap{
    width:100%;
    border-radius: 16px;
    border:1px dashed rgba(255,255,255,.18);
    background: linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    display:grid; place-items:center; overflow:hidden;
  }
  .photo{ width:100%; height:100%; object-fit: cover; display:block; filter: drop-shadow(0 10px 30px rgba(0,0,0,.45)); }
  .upload-bar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:10px; font:600 12px/1 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "PingFang SC", "Microsoft YaHei", sans-serif; opacity:.95; }
  .btn{
    padding:10px 14px; border-radius: 12px; cursor:pointer; user-select:none; touch-action: manipulation;
    background: var(--glass-strong); border:1px solid rgba(255,255,255,.18);
    color:#fff; box-shadow: var(--shadow); transition:.2s;
  }
  .btn:active{ transform: scale(.98); }
  .sr-only{ position:absolute; left:-9999px; width:1px; height:1px; overflow:hidden; }

  /* æ—…è¡Œç›¸å†Œï¼ˆå¯æ»‘åŠ¨ 4 å¼ ï¼‰ */
  .carousel{ width:100%; aspect-ratio: 4/3; overflow-x:auto; -webkit-overflow-scrolling:touch;
             scroll-snap-type:x mandatory; display:grid; grid-auto-flow:column; grid-auto-columns:100%; gap:10px; overscroll-behavior-x:contain; }
  .slide{ position:relative; border-radius: 14px; overflow:hidden; border:1px solid rgba(255,255,255,.14);
          background: linear-gradient(120deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
          scroll-snap-align:center; }
  .slide .ph{ position:absolute; inset:0; display:grid; place-items:center; color:rgba(255,255,255,.7); font:700 12px/1.2 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"PingFang SC","Microsoft YaHei",sans-serif; }

  .dots{ display:flex; gap:6px; justify-content:center; margin-top:8px; }
  .dot{ width:6px; height:6px; border-radius:999px; background:rgba(255,255,255,.35); }
  .dot.active{ background:#fff; }
</style>
</head>
<body>
<canvas id="c" aria-hidden="true"></canvas>

<!-- é¡¶éƒ¨ç¥ç¦ä¸æç¤º -->
<div class="overlay" id="overlay-main">
  <div class="msg" id="msg">ç”Ÿæ—¥å¿«ä¹å“‡å…³æ¬£ âœ¨</div>
  <div class="hint">ç‚¹å‡»/è§¦æ‘¸æ”¾çƒŸèŠ± Â· æŒ‰ <b>H</b> å¿ƒå½¢çƒŸèŠ± Â· æŒ‰ <b>U</b> åˆ‡æ¢å°å…”å­</div>
</div>
<div class="badge">Made with â¤ï¸ + Canvas</div>

<!-- ä¸­å¤®èœå•ï¼ˆç«–å‘ä¸Šä¸‹ç»“æ„ï¼‰ -->
<nav class="center-menu" id="menu" aria-label="åˆ†åŒºå¯¼èˆª">
  <div class="center-stack" role="list">
    <button class="menu-btn" id="btn-travel"  aria-controls="panel-travel"  role="listitem"><span class="emoji">âœˆï¸</span>æ—…æ¸¸</button>
    <button class="menu-btn" id="btn-concert" aria-controls="panel-concert" role="listitem"><span class="emoji">ğŸ¤</span>æ¼”å”±ä¼š</button>
    <button class="menu-btn" id="btn-sport"   aria-controls="panel-sport"   role="listitem"><span class="emoji">ğŸƒâ€â™€ï¸</span>ç”Ÿå‘½åœ¨äºè¿åŠ¨</button>
  </div>
</nav>

<!-- æ—…æ¸¸ï¼šå¯æ»‘åŠ¨ 4 å¼  + æœ¬åœ°æ·»åŠ  -->
<section class="panel" id="panel-travel" aria-hidden="true" role="dialog" aria-labelledby="travel-title">
  <div class="topbar"><button class="back-btn" data-back>â† è¿”å›çƒŸèŠ±</button></div>
  <div class="panel-card">
    <div class="text">
      <h2 id="travel-title">æ—…è¡Œç•™å½±</h2>
      <p>è¿™ä¸€å²ä½ å»äº†å‘¼å’Œæµ©ç‰¹å’Œä¹Œå…°å¯Ÿå¸ƒï¼Œè¯»æ‡‚å¡åŒ—é›ªéœçš„å—æ–¹å¥³å­©ä¹Ÿä¼šè¯»æ‡‚ä¸Šæµ·çš„æ˜¥å¤©ã€‚</p>
      <div class="upload-bar">
        <button class="btn" id="pick-travel">â• æ·»åŠ æ—…è¡Œç…§ç‰‡ï¼ˆæœ€å¤š 4 å¼ ï¼‰</button>
        <input type="file" id="travel-input" accept="image/*" multiple class="sr-only" />
      </div>
    </div>
    <div class="silhouette-wrap" aria-label="æ—…è¡Œç›¸å†Œ">
      <div id="travel-carousel" class="carousel">
        <div class="slide"><div class="ph">æ—…è¡Œå ä½ 1</div></div>
        <div class="slide"><div class="ph">æ—…è¡Œå ä½ 2</div></div>
        <div class="slide"><div class="ph">æ—…è¡Œå ä½ 3</div></div>
        <div class="slide"><div class="ph">æ—…è¡Œå ä½ 4</div></div>
      </div>
      <div id="travel-dots" class="dots" aria-hidden="true"></div>
    </div>
  </div>
</section>

<!-- æ¼”å”±ä¼šï¼šä¸€å¼ æ™®é€šå›¾ç‰‡ï¼ˆå›ºå®šè·¯å¾„ï¼‰ -->
<section class="panel" id="panel-concert" aria-hidden="true" role="dialog" aria-labelledby="concert-title">
  <div class="topbar"><button class="back-btn" data-back>â† è¿”å›çƒŸèŠ±</button></div>
  <div class="panel-card">
    <div class="text">
      <h2 id="concert-title">èˆå°ä¸æ˜Ÿå…‰</h2>
      <p>è¿™ä¸€å²ä½ å»äº†è®¸åµ©å’Œé‚“ç´«æ£‹çš„æ¼”å”±ä¼šï¼Œä½ ä¸¾èµ·ç¯ç‰Œçš„åˆ¹é‚£ä¹Ÿæˆäº†åˆ«äººçœ¼ä¸­çš„æ˜Ÿå…‰ã€‚</p>
    </div>
    <div class="silhouette-wrap" aria-label="æ¼”å”±ä¼šç…§ç‰‡">
      <img class="photo" id="concert-photo" src="assets/concert.jpg" alt="è®¸åµ© / é‚“ç´«æ£‹æ¼”å”±ä¼šç…§ç‰‡">
    </div>
  </div>
</section>

<!-- è¿åŠ¨ï¼šåªæ·»åŠ  1 å¼ ï¼ˆå†æ¬¡é€‰æ‹©ä¼šè¦†ç›–ï¼‰ -->
<section class="panel" id="panel-sport" aria-hidden="true" role="dialog" aria-labelledby="sport-title">
  <div class="topbar"><button class="back-btn" data-back>â† è¿”å›çƒŸèŠ±</button></div>
  <div class="panel-card">
    <div class="text">
      <h2 id="sport-title">ç”Ÿå‘½åœ¨äºè¿åŠ¨</h2>
      <p>è¿™ä¸€å²ï¼Œæ¯ä¸€æ»´å å…¥é»„æµ¦æ±Ÿçš„æ±—ï¼Œéƒ½æ˜¯é€†æµè€Œä¸Šçš„èˆŸã€‚æ¯ä¸€æ¬¡å¥èº«æˆ¿é‡Œçš„åŠ›ç«­ï¼Œéƒ½åœ¨å¤ºå›ç”Ÿæ´»çš„é‡é‡ã€‚</p>
      <div class="upload-bar">
        <button class="btn" id="pick-sport">â• é€‰æ‹©è¿åŠ¨ç…§ç‰‡ï¼ˆä»… 1 å¼ ï¼‰</button>
        <input type="file" id="sport-input" accept="image/*" class="sr-only" />
      </div>
    </div>
    <div class="silhouette-wrap" aria-label="è¿åŠ¨å•å¼ ">
      <div id="sport-holder" class="slide" style="width:100%; aspect-ratio:4/3;">
        <div class="ph">è¿åŠ¨å ä½</div>
      </div>
    </div>
  </div>
</section>

<script>
;(() => {
  // ========= å°å·¥å…· =========
  const rand = (a,b) => Math.random()*(b-a)+a
  const clamp = (v,a,b)=>Math.min(b,Math.max(a,v))
  const TAU = Math.PI*2

  // ========= ç”»å¸ƒ =========
  const canvas = document.getElementById('c')
  const ctx = canvas.getContext('2d')
  const DPR = Math.max(1, Math.min(2, devicePixelRatio || 1))
  function resize() {
    const {innerWidth:w, innerHeight:h} = window
    canvas.width = Math.floor(w * DPR)
    canvas.height = Math.floor(h * DPR)
    canvas.style.width = w+'px'
    canvas.style.height = h+'px'
    ctx.setTransform(DPR,0,0,DPR,0,0)
  }
  addEventListener('resize', resize, {passive:true}); resize()

  function drawBackground(alpha=1){
    const w = canvas.width / DPR, h = canvas.height / DPR
    const g = ctx.createLinearGradient(0,0,0,h)
    g.addColorStop(0,'#050914'); g.addColorStop(1,'#0e1630')
    ctx.globalAlpha = alpha; ctx.fillStyle = g; ctx.fillRect(0,0,w,h); ctx.globalAlpha = 1
  }

  // ========= çƒŸèŠ±ç³»ç»Ÿ =========
  const rockets = [], particles = []
  let heartMode = false, showBunny = true, paused = false

  function launch(x = rand(50, canvas.width/DPR-50)) {
    const w = canvas.width/DPR, h = canvas.height/DPR
    const start = { x, y: h + 10 }
    const tx = x + rand(-w*0.15, w*0.15), ty = rand(60, h*0.45)
    const speed = rand(7.5, 9.5)
    rockets.push({ x:start.x, y:start.y, tx, ty, vx:(tx-start.x)/speed, vy:(ty-start.y)/speed, life:speed, color:`hsl(${Math.floor(rand(0,360))} 85% 65%)`, trail:[] })
  }
  function explode(x,y,color){
    const count = Math.floor(rand(60,110))
    const hue = Math.floor(rand(0,360))
    const baseColor = color || `hsl(${hue} 85% 65%)`
    for(let i=0;i<count;i++){
      let angle, speed
      if(heartMode){ const t = rand(0, TAU), r = 1 - Math.sin(t); angle=t; speed=rand(1.2,2.2)*r }
      else { angle = rand(0,TAU); speed = rand(1.2,2.6) * (0.9 + 0.1*Math.random()) }
      particles.push({ x,y, vx:Math.cos(angle)*speed, vy:Math.sin(angle)*speed, drag:0.985, gravity:0.04, size:rand(1.2,2.2), alpha:1, decay:rand(0.007,0.018), color:baseColor, trail:[] })
    }
    particles.push({x,y,vx:0,vy:0,drag:1,gravity:0,size:4,alpha:1,decay:0.06,color:'#fff',trail:[]})
  }
  function stepFireworks(){
    for (let i=rockets.length-1;i>=0;i--){
      const r = rockets[i]
      r.trail.push({x:r.x,y:r.y}); if(r.trail.length>5) r.trail.shift()
      r.x += r.vx; r.y += r.vy; r.life -= 1; r.vy += 0.04
      const near = Math.hypot(r.x-r.tx, r.y-r.ty) < 10
      if (r.life<=0 || near || r.vy>0.6){ explode(r.x,r.y,r.color); rockets.splice(i,1) }
    }
    for (let i=particles.length-1;i>=0;i--){
      const p = particles[i]
      p.trail.push({x:p.x,y:p.y}); if(p.trail.length>6) p.trail.shift()
      p.vx *= p.drag; p.vy = p.vy * p.drag + p.gravity; p.x += p.vx; p.y += p.vy; p.alpha -= p.decay
      if(p.alpha<=0.02) particles.splice(i,1)
    }
  }
  function renderFireworks(){
    ctx.globalCompositeOperation = 'source-over'; drawBackground(0.2)
    ctx.globalCompositeOperation = 'lighter'
    rockets.forEach(r=>{
      ctx.strokeStyle = r.color; ctx.lineWidth = 1.5; ctx.beginPath()
      const t=r.trail; if(t.length){ ctx.moveTo(t[0].x,t[0].y); for(let i=1;i<t.length;i++) ctx.lineTo(t[i].x,t[i].y); ctx.lineTo(r.x,r.y) }
      ctx.stroke()
    })
    particles.forEach(p=>{
      ctx.globalAlpha = clamp(p.alpha,0,1); ctx.strokeStyle = p.color; ctx.lineWidth = p.size
      const t=p.trail; if(t.length){ ctx.beginPath(); ctx.moveTo(t[0].x,t[0].y); for(let i=1;i<t.length;i++) ctx.lineTo(t[i].x,t[i].y); ctx.lineTo(p.x,p.y); ctx.stroke() }
      ctx.beginPath(); ctx.arc(p.x,p.y,p.size*0.5,0,TAU); ctx.fillStyle = p.color; ctx.fill(); ctx.globalAlpha = 1
    })
    ctx.globalCompositeOperation = 'source-over'
  }

  // ========= ä¹Œæ’’å¥‡å…”å­ï¼ˆçŸ¢é‡ç»˜åˆ¶ï¼‰ =========
  function drawBunny(x, y, s=1){
    ctx.save(); ctx.translate(x,y); ctx.scale(s,s)
    ctx.lineCap='round'; ctx.lineJoin='round'; ctx.strokeStyle='#f0f4ff'; ctx.lineWidth=3
    ctx.beginPath(); ctx.moveTo(-40,10); ctx.quadraticCurveTo(-52,-10,-40,-28); ctx.quadraticCurveTo(-30,-70,-12,-28);
    ctx.quadraticCurveTo(0,-18,12,-28); ctx.quadraticCurveTo(30,-70,40,-28); ctx.quadraticCurveTo(52,-10,40,10); ctx.quadraticCurveTo(0,38,-40,10); ctx.stroke()
    ctx.beginPath(); ctx.arc(-14,-4,2.2,0,TAU); ctx.arc(14,-4,2.2,0,TAU); ctx.stroke()
    ctx.beginPath(); ctx.moveTo(-6,8); ctx.quadraticCurveTo(-3,12,0,8); ctx.quadraticCurveTo(3,12,6,8); ctx.stroke()
    ctx.beginPath(); ctx.moveTo(-28,22); ctx.quadraticCurveTo(-16,18,-10,24); ctx.moveTo(28,22); ctx.quadraticCurveTo(16,18,10,24); ctx.stroke()
    ctx.beginPath(); ctx.moveTo(-20,36); ctx.quadraticCurveTo(-8,40,0,36); ctx.moveTo(20,36); ctx.quadraticCurveTo(8,40,0,36); ctx.stroke()
    ctx.restore()
  }

  // ========= ç¥ç¦è¯­ï¼ˆé»˜è®¤å°±æ˜¯â€œç”Ÿæ—¥å¿«ä¹å“‡å…³æ¬£ âœ¨â€ï¼‰ =========
  const params = new URLSearchParams(location.search)
  const msgEl = document.getElementById('msg')
  const defaultMsg = 'ç”Ÿæ—¥å¿«ä¹å“‡å…³æ¬£ âœ¨'
  const msg = (params.get('msg') || defaultMsg).slice(0, 120)
  msgEl.textContent = msg

  // ========= è·¯ç”±ä¸å¼€åˆ =========
  const panelTravel  = document.getElementById('panel-travel')
  const panelConcert = document.getElementById('panel-concert')
  const panelSport   = document.getElementById('panel-sport')
  const overlayMain  = document.getElementById('overlay-main')
  const menu         = document.getElementById('menu')
  const btnTravel    = document.getElementById('btn-travel')
  const btnConcert   = document.getElementById('btn-concert')
  const btnSport     = document.getElementById('btn-sport')

  function openPanel(which){
    const panel = which==='travel' ? panelTravel : which==='concert' ? panelConcert : panelSport
    panel.classList.add('show'); panel.setAttribute('aria-hidden','false')
    overlayMain.style.display = 'none'; menu.style.display = 'none'; paused = true; location.hash = which
  }
  function closePanel(){
    [panelTravel, panelConcert, panelSport].forEach(p=>{ p.classList.remove('show'); p.setAttribute('aria-hidden','true') })
    overlayMain.style.display = ''; menu.style.display = ''; paused = false
    history.pushState('', document.title, location.pathname + location.search)
  }
  btnTravel.addEventListener('click', ()=>openPanel('travel'))
  btnConcert.addEventListener('click', ()=>openPanel('concert'))
  btnSport.addEventListener('click',   ()=>openPanel('sport'))
  document.querySelectorAll('[data-back]').forEach(b=>b.addEventListener('click', closePanel))
  addEventListener('keydown', e=>{ if(e.key==='Escape') closePanel() })
  function applyHash(){ if(location.hash==='#travel') openPanel('travel'); else if(location.hash==='#concert') openPanel('concert'); else if(location.hash==='#sport') openPanel('sport'); else closePanel() }
  addEventListener('hashchange', applyHash); applyHash()

  // ========= ä¸»å¾ªç¯ =========
  function tick(){
    if(!paused){
      const chance = (canvas.width/DPR) * (canvas.height/DPR) / (1280*720)
      if(Math.random() < 0.018 * clamp(chance, 0.7, 1.6)){ launch() }
      stepFireworks(); renderFireworks()
      const w = canvas.width/DPR, h = canvas.height/DPR
      drawBunny(w*0.82, h*0.72, Math.min(1.2, Math.max(0.7, w/1200)))
    }else{
      drawBackground(0.5)
    }
    requestAnimationFrame(tick)
  }
  requestAnimationFrame(tick)
  addEventListener('pointerdown', e=>{
    if(paused) return
    const rect = canvas.getBoundingClientRect()
    const x = (e.clientX - rect.left)
    launch(x)
    setTimeout(()=>explode(x, Math.random()*(rect.height*0.3)+rect.height*0.2, `hsl(${Math.floor(Math.random()*360)} 90% 70%)`), 450)
  })
  addEventListener('keydown', e=>{ if(e.key==='h'||e.key==='H') heartMode=!heartMode; if(e.key==='u'||e.key==='U') showBunny=!showBunny })

  for(let i=0;i<3;i++) setTimeout(()=>launch(rand(80, canvas.width/DPR-80)), i*220)

  // ========= æ—…è¡Œç›¸å†Œï¼ˆæœ€å¤š 4 å¼ ï¼Œå¯æ»‘åŠ¨ï¼‰ =========
  const travelInput = document.getElementById('travel-input')
  const travelBtn   = document.getElementById('pick-travel')
  const travelCar   = document.getElementById('travel-carousel')
  const travelDots  = document.getElementById('travel-dots')
  let travelCount = 0, travelMax = 4

  // å¦‚æœ assets é‡Œé¢„æ”¾äº† travel1~4.jpgï¼Œåˆ™è‡ªåŠ¨åŠ è½½
  const preloadTravel = ['assets/travel1.jpg','assets/travel2.jpg','assets/travel3.jpg','assets/travel4.jpg']
  ;(async () => {
    for (let i=0;i<preloadTravel.length;i++){
      const url = preloadTravel[i]
      try{
        const exists = await fetch(url, {method:'HEAD', cache:'no-store'})
        if(exists.ok){ addTravelSlide(url) }
      }catch(e){/* ignore */}
    }
    buildDots()
  })()

  travelBtn.addEventListener('click', ()=>travelInput.click())
  travelInput.addEventListener('change', e=>{
    const files = Array.from(e.target.files || []).filter(f=>f.type.startsWith('image/'))
    for(const f of files){
      if(travelCount>=travelMax) break
      const url = URL.createObjectURL(f)
      addTravelSlide(url, true)
    }
    buildDots()
    // è·³åˆ°æœ€åä¸€å¼ 
    travelCar.scrollTo({left: travelCar.scrollWidth, behavior:'smooth'})
    travelInput.value = ''
  })

  function addTravelSlide(src, revoke=false){
    if(travelCount>=travelMax) return
    const img = new Image()
    img.loading='lazy'; img.src=src; img.className='photo'; img.alt='æ—…è¡Œç…§ç‰‡'
    const slide = document.createElement('div'); slide.className='slide'
    slide.appendChild(img)
    // ç”¨æ–°çš„ slide æ›¿æ¢ç¬¬ä¸€ä¸ªå ä½
    const ph = travelCar.querySelector('.slide .ph')
    if(ph){ ph.parentElement.replaceWith(slide) } else { travelCar.appendChild(slide) }
    travelCount++
    if(revoke) img.addEventListener('load', ()=>URL.revokeObjectURL(src), {once:true})
  }

  // å°åœ†ç‚¹ & é«˜äº®
  function buildDots(){
    const total = travelCar.querySelectorAll('.slide').length
    travelDots.innerHTML = ''
    for(let i=0;i<total;i++){
      const d = document.createElement('span'); d.className='dot' + (i===0?' active':'')
      d.addEventListener('click', ()=>{
        travelCar.scrollTo({left: i * travelCar.clientWidth, behavior:'smooth'})
      })
      travelDots.appendChild(d)
    }
  }
  function updateDots(){
    const idx = Math.round(travelCar.scrollLeft / travelCar.clientWidth)
    ;[...travelDots.children].forEach((el,i)=> el.classList.toggle('active', i===idx))
  }
  travelCar.addEventListener('scroll', ()=>{ requestAnimationFrame(updateDots) })

  // ========= è¿åŠ¨ï¼šåªæ·»åŠ  1 å¼ ï¼ˆè¦†ç›–å¼ï¼‰ =========
  const sportInput = document.getElementById('sport-input')
  const sportBtn   = document.getElementById('pick-sport')
  const sportHold  = document.getElementById('sport-holder')

  // è‹¥æœ‰ assets/sport.jpg åˆ™è‡ªåŠ¨åŠ è½½
  ;(async () => {
    try{
      const resp = await fetch('assets/sport.jpg', {method:'HEAD', cache:'no-store'})
      if(resp.ok) setSportImage('assets/sport.jpg')
    }catch(e){}
  })()

  sportBtn.addEventListener('click', ()=>sportInput.click())
  sportInput.addEventListener('change', e=>{
    const f = (e.target.files || [])[0]
    if(!f || !f.type.startsWith('image/')) return
    const url = URL.createObjectURL(f)
    setSportImage(url, true)
    sportInput.value = ''
  })

  function setSportImage(src, revoke=false){
    const img = new Image()
    img.loading='lazy'; img.src=src; img.className='photo'; img.alt='è¿åŠ¨ç…§ç‰‡'; img.style.width='100%'; img.style.height='100%'
    const ph = sportHold.querySelector('.ph')
    if(ph){ sportHold.innerHTML=''; sportHold.appendChild(img) }
    else{
      // å·²æœ‰å›¾ï¼Œç›´æ¥æ›¿æ¢
      const old = sportHold.querySelector('img')
      if(old) old.replaceWith(img)
      else sportHold.appendChild(img)
    }
    if(revoke) img.addEventListener('load', ()=>URL.revokeObjectURL(src), {once:true})
  }
})()
</script>
</body>
</html>
